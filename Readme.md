# img_resizer

指定した画像ファイルやフォルダ内の画像を、一括でパーセンテージ指定によりリサイズするPythonツールです。フォルダを指定した場合、オプションを指定することでサブフォルダを再帰的に処理することも可能です。

## 特徴

*   **一括リサイズ**: 複数のファイルやフォルダをまとめて指定可能。
*   **正確なアスペクト比**: スマホなどで撮影された回転情報（EXIF Orientation）を持つ画像も、正しく向きを補正した上で縦横比を維持してリサイズします。
*   **再帰処理対応**: `--recursive` オプションでサブフォルダ内の画像も全て探索。
*   **非破壊設計**: 元ファイルは上書きせず、プレフィックス（接頭辞）を付けた別名ファイルとして保存。
*   **高品質**:
    *   Lanczosフィルタによる高品質なリサンプル。
    *   主要なメタデータ（EXIF, ICCプロファイル）を可能な限り維持。
*   **広範なフォーマット**: JPEG, PNG, GIF, BMP, TIFF, WebP に対応。
*   **アニメーションGIF対応**: フレームごとの持続時間（duration）を維持したままリサイズが可能。

## 動作環境

*   Python 3.8 以上推奨
*   Pillow (PIL) ライブラリ

### インストール

必要なライブラリをインストールしてください。

```bash
pip install pillow
```

## 使い方

基本構文:
`python img_resizer.py [対象ファイル/フォルダ...] [オプション]`

### 使用例

#### 1. 単一のファイルを 30% に縮小する
```bash
python img_resizer.py photo.jpg -p 30
# 出力: resized_photo.jpg (元の30%のサイズ)
```

#### 2. 複数のファイルを 80% にし、プレフィックスを "small_" にする
```bash
python img_resizer.py image1.png image2.webp -p 80 -o small_
# 出力: small_image1.png, small_image2.webp
```

#### 3. フォルダ内の画像を 50%（デフォルト）に縮小
```bash
python img_resizer.py ./images
# ./images 直下の画像のみ処理されます
```

#### 4. フォルダ内を再帰的に処理（サブフォルダ含む）
```bash
python img_resizer.py ./images --recursive
# ./images 以下の全階層の画像が処理され、各画像と同じフォルダ内に出力されます
```

## オプション一覧

| オプション | 短縮形 | 説明 | デフォルト値 |
| :--- | :--- | :--- | :--- |
| `--percent` | `-p` | リサイズ率（%）。0より大きい数値を指定（例: 50.0）。 | `50.0` |
| `--prefix` | `-o` | 出力ファイル名の先頭に付く文字列。 | `resized_` |
| `--recursive` | `-r` | フォルダ指定時、サブフォルダも再帰的に探索します。 | OFF |
| `--help` | `-h` | ヘルプメッセージを表示します。 | - |

## 注意事項

*   **出力先**: リサイズされたファイルは、**元ファイルと同じフォルダ**に保存されます。
*   **ファイル名重複の回避**: 出力先フォルダに同名のファイルが既に存在する場合、`resized_photo_1.jpg` のように自動的に連番を付与して保存し、上書きを防ぎます。
*   **EXIF回転補正**: スマホ等で撮影された向き情報を持つ画像は、リサイズ時に「正しい向き」へと回転処理が行われます。そのため、元のピクセルデータ上の縦横と、出力後の縦横が入れ替わることがありますが、これは見た目上の正しいアスペクト比を維持するための仕様です。
*   **JPEGの透過色**: PNGなどの透過情報を持つ画像をJPEG形式に変換して保存する場合、透過部分は自動的に白色に置き換えられます。